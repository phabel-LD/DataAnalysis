---
title: "ISSSTE_CastillaCalderonStevens"
author: "Phabel López"
date: "2025-07-20"
output:
  word_document: default
  html_document: default
---

```{r echo=FALSE}
# Libraries
library(readxl)
library(psych)
library(Hmisc)
library(stringr)
library(dplyr)
library(tidyr)

library(ggpubr)
library(rstatix)
library(gtsummary)

library(ggplot2)
library(plotly)
library(car)
library(babynames)
library(gapminder)
```

# Castilla Calderon Stevens

## 1) Preprocesamiento

### 1.1) Obtener y revisar datos originales

```{r echo=FALSE}
data <- data.frame(read_excel("Data.xlsx"))
#data
```

```{r echo=FALSE}
data$GÉNERO[data$GÉNERO == 1] <- "Masculino"
data$GÉNERO[data$GÉNERO == 2] <- "Femenino"
data$APFEL <- as.factor(data$APFEL)
data$NAUSEA <- as.factor(data$NAUSEA)
data$VOMITO[data$VOMITO == 0] <- "NO"
cols <- c("TIEMPO.DE.ANESTESIA", "TIEMPO.DE.CIRUGIA")
data <- data %>%
  mutate(across(cols, ~as.numeric(sapply(., function(x) strsplit(x, " ")[[1]][1]))))
#data
```


## 1.2) Procesar archivo archivo y hacer correcciones

### 1.3 Dividir en Grupos

```{r echo=FALSE}
# Grupo 1
group_1 <- data[data$GRUPO == "A",]
group_1
```

```{r echo=FALSE}
# Grupo 2
group_2 <- data[data$GRUPO == "B",]
group_2
```

```{r echo=FALSE, fig.height=8, fig.width=10}
# Group
data_summary <- data %>%
  group_by(GRUPO) %>%
  summarise(n = n(), .groups = 'drop')

# Stacked barplot
p <- ggplot(data_summary, aes(x = GRUPO, y = n, fill = GRUPO)) +
  geom_bar(stat = "identity", position = "stack", colour = "black", lwd = 0.5) +
  labs(title = "Proporciones de Grupos",
       fill = "Grupo",
       x = NULL,
       y = "Frequencia") +
  theme_minimal()
p
#ggplotly(p)
```

## 2) Estadística Descriptiva por Grupo

### 2.1) Descripción Global para Grupo A

Medidas de Tendencia Central para Variables Numéricas Grupo A

```{r echo=FALSE}
psych::describe(group_1[sapply(group_1, class) == 'numeric'])
```

Frequencias detalladas de variables numéricas

```{r echo=FALSE}
Hmisc::describe(group_1[sapply(group_1, class) == 'numeric'])
```

### 2.2) Descripción Global para Grupo B

Medidas de Tendencia Central para Variables Numéricas Grupo 2: GRUPO B LIDOCAINA PERFUSION

```{r echo=FALSE}
psych::describe(group_2[sapply(group_2, class) == 'numeric'])
```

Frequencias detalladas de variables numéricas

```{r echo=FALSE}
Hmisc::describe(group_2[sapply(group_2, class) == 'numeric'])
```

### 2.3) Edad

Plot de Violín por Grupo
```{r echo=FALSE, fig.height=8, fig.width=10}
p <- ggplot(data, aes(x=GRUPO, y=EDAD..AÑOS., color=GRUPO)) + 
    geom_violin(trim=FALSE, alpha=0.5) +
    geom_jitter(shape=16, position=position_jitter(0.1)) +
    geom_boxplot(width=0.1) +
    labs(fill = "Grupo",
       x="Grupo",
       y="Edad",
       title="Violin Plots de Edad por Grupo") +
    theme(plot.title = element_text(size=12))
p
#ggplotly(p)
```

Histograma por Grupos
```{r echo=FALSE, fig.height=8, fig.width=10}
# Histogram
p <- ggplot(data, aes(x = EDAD..AÑOS., fill = factor(GRUPO))) +
  geom_histogram(colour = "black",
                 lwd = 0.75,
                 linetype = 1,
                 position = "identity",
                 binwidth = 5,
                 alpha = 0.5) +
  labs(fill = "Grupo",
       x="Edad",
       y="Frequencia",
       title="Histograma de Edad por Grupo") +
  theme(plot.title = element_text(size=12))
p
#ggplotly(p)
```

### 2.4) Género

Gráficas de Barras Agrupadas por Grupo.
```{r echo=FALSE, fig.height=8, fig.width=10}
# Group
data_summary <- data %>%
  group_by(GRUPO, GÉNERO) %>%
  summarise(n = n(), .groups = 'drop')

# Plot
p <- ggplot(data_summary, aes(x = GRUPO, y = n, fill = GÉNERO)) +
  geom_bar(stat = "identity", position = position_dodge(), colour = "black", lwd = 0.5) +
  geom_text(aes(x = GRUPO, y = n + 0.25, label = n),
            position = position_dodge(width = 0.9),
            vjust = -0.25) +
  labs(title = "Proporciones de Género por Grupo",
       fill = "Género",
       x = NULL,
       y = "Frequencia") +
  theme_minimal()
p
#ggplotly(p)
```

### 2.5) Talla (cm)

Plot de Violín por Grupo
```{r echo=FALSE, fig.height=8, fig.width=10}
p <- ggplot(data, aes(x=GRUPO, y=TALLA..CM., color=GRUPO)) + 
    geom_violin(trim=FALSE, alpha=0.5) +
    geom_jitter(shape=16, position=position_jitter(0.1)) +
    geom_boxplot(width=0.1) +
    labs(fill = "Grupo",
       x="Grupo",
       y="Talla (cm)",
       title="Violin Plots de Talla (cm) por Grupo") +
    theme(plot.title = element_text(size=12))
p
#ggplotly(p)
```

Histograma por Grupos
```{r echo=FALSE, fig.height=8, fig.width=10}
# Histogram
p <- ggplot(data, aes(x = TALLA..CM., fill = factor(GRUPO))) +
  geom_histogram(colour = "black",
                 lwd = 0.75,
                 linetype = 1,
                 position = "identity",
                 binwidth = 5,
                 alpha = 0.5) +
  labs(fill = "Grupo",
       x="Talla (cm)",
       y="Frequencia",
       title="Histograma de Talla (cm) por Grupo") +
  theme(plot.title = element_text(size=12))
p
#ggplotly(p)
```

### 2.6) Peso (kg)

Plot de Violín por Grupo
```{r echo=FALSE, fig.height=8, fig.width=10}
p <- ggplot(data, aes(x=GRUPO, y=PESO..KG., color=GRUPO)) + 
    geom_violin(trim=FALSE, alpha=0.5) +
    geom_jitter(shape=16, position=position_jitter(0.1)) +
    geom_boxplot(width=0.1) +
    labs(fill = "Grupo",
       x="Grupo",
       y="Peso (kg)",
       title="Violin Plots de Peso (kg) por Grupo") +
    theme(plot.title = element_text(size=12))
p
#ggplotly(p)
```

Histograma por Grupos
```{r echo=FALSE, fig.height=8, fig.width=10}
# Histogram
p <- ggplot(data, aes(x = PESO..KG., fill = factor(GRUPO))) +
  geom_histogram(colour = "black",
                 lwd = 0.75,
                 linetype = 1,
                 position = "identity",
                 binwidth = 10,
                 alpha = 0.5) +
  labs(fill = "Grupo",
       x="Peso (kg)",
       y="Frequencia",
       title="Histograma de Peso (kg) por Grupo") +
  theme(plot.title = element_text(size=12))
p
#ggplotly(p)
```

### 2.7) ASA

Gráficas de Barras Agrupadas por Grupo.
```{r echo=FALSE, fig.height=8, fig.width=10}
# Group
data_summary <- data %>%
  group_by(GRUPO, ASA) %>%
  summarise(n = n(), .groups = 'drop')

# Plot
p <- ggplot(data_summary, aes(x = GRUPO, y = n, fill = ASA)) +
  geom_bar(stat = "identity", position = position_dodge(), colour = "black", lwd = 0.5) +
  geom_text(aes(x = GRUPO, y = n + 0.25, label = n),
            position = position_dodge(width = 0.9),
            vjust = -0.25) +
  labs(title = "Proporciones de ASA por Grupo",
       fill = "ASA",
       x = NULL,
       y = "Frequencia") +
  theme_minimal()
p
#ggplotly(p)
```

Gráficas de Pie con Pruebas de X2
```{r echo=FALSE, fig.height=6, fig.width=10}
# Categorical Test
p <- ggstatsplot::ggpiestats(
    data = data,
    x = ASA,
    y = GRUPO,
    type = "nonparametric",
    title = "Proporciones de ASA por Grupo",
    pairwise.display = "significant",
    p.adjust.method = "holm"
)
p
```

### 2.8) Escala Apfel

Gráficas de Barras Agrupadas por Grupo.
```{r echo=FALSE, fig.height=8, fig.width=10}
# Group
data_summary <- data %>%
  group_by(GRUPO, APFEL) %>%
  summarise(n = n(), .groups = 'drop')

# Plot
p <- ggplot(data_summary, aes(x = GRUPO, y = n, fill = APFEL)) +
  geom_bar(stat = "identity", position = position_dodge(), colour = "black", lwd = 0.5) +
  geom_text(aes(x = GRUPO, y = n + 0.25, label = n),
            position = position_dodge(width = 0.9),
            vjust = -0.25) +
  labs(title = "Proporciones de Escala Apfel por Grupo",
       fill = "Escala Apfel",
       x = NULL,
       y = "Frequencia") +
  theme_minimal()
p
#ggplotly(p)
```

Gráficas de Pie con Pruebas de X2
```{r echo=FALSE, fig.height=6, fig.width=10}
# Categorical Test
p <- ggstatsplot::ggpiestats(
    data = data,
    x = APFEL,
    y = GRUPO,
    type = "nonparametric",
    title = "Proporciones de Escala Apfel por Grupo",
    pairwise.display = "significant",
    p.adjust.method = "holm"
)
p
```

### 2.9) Náusea

Gráficas de Barras Agrupadas por Grupo.
```{r echo=FALSE, fig.height=8, fig.width=10}
# Group
data_summary <- data %>%
  group_by(GRUPO, NAUSEA) %>%
  summarise(n = n(), .groups = 'drop')

# Plot
p <- ggplot(data_summary, aes(x = GRUPO, y = n, fill = NAUSEA)) +
  geom_bar(stat = "identity", position = position_dodge(), colour = "black", lwd = 0.5) +
  geom_text(aes(x = GRUPO, y = n + 0.25, label = n),
            position = position_dodge(width = 0.9),
            vjust = -0.25) +
  labs(title = "Proporciones de Náusea por Grupo",
       fill = "Náusea",
       x = NULL,
       y = "Frequencia") +
  theme_minimal()
p
#ggplotly(p)
```

Gráficas de Pie con Pruebas de X2
```{r echo=FALSE, fig.height=6, fig.width=10}
# Categorical Test
p <- ggstatsplot::ggpiestats(
    data = data,
    x = NAUSEA,
    y = GRUPO,
    type = "nonparametric",
    title = "Proporciones de Náusea por Grupo",
    pairwise.display = "significant",
    p.adjust.method = "holm"
)
p
```

### 2.10) Vómito

Gráficas de Barras Agrupadas por Grupo.
```{r echo=FALSE, fig.height=8, fig.width=10}
# Group
data_summary <- data %>%
  group_by(GRUPO, VOMITO) %>%
  summarise(n = n(), .groups = 'drop')

# Plot
p <- ggplot(data_summary, aes(x = GRUPO, y = n, fill = VOMITO)) +
  geom_bar(stat = "identity", position = position_dodge(), colour = "black", lwd = 0.5) +
  geom_text(aes(x = GRUPO, y = n + 0.25, label = n),
            position = position_dodge(width = 0.9),
            vjust = -0.25) +
  labs(title = "Proporciones de Vómito por Grupo",
       fill = "Vómito",
       x = NULL,
       y = "Frequencia") +
  theme_minimal()
p
#ggplotly(p)
```

Gráficas de Pie con Pruebas de X2
```{r echo=FALSE, fig.height=6, fig.width=10}
# Categorical Test
p <- ggstatsplot::ggpiestats(
    data = data,
    x = VOMITO,
    y = GRUPO,
    type = "nonparametric",
    title = "Proporciones de Vómito por Grupo",
    pairwise.display = "significant",
    p.adjust.method = "holm"
)
p
```

### 2.11) Tiempo de Cirugía (min)

Plot de Violín por Grupo
```{r echo=FALSE, fig.height=8, fig.width=10}
p <- ggplot(data, aes(x=GRUPO, y=TIEMPO.DE.CIRUGIA, color=GRUPO)) + 
    geom_violin(trim=FALSE, alpha=0.5) +
    geom_jitter(shape=16, position=position_jitter(0.1)) +
    geom_boxplot(width=0.1) +
    labs(fill = "Grupo",
       x="Grupo",
       y="Tiempo de Cirugía (min)",
       title="Violin Plots de Tiempo de Cirugía (min) por Grupo") +
    theme(plot.title = element_text(size=12))
p
#ggplotly(p)
```

Histograma por Grupos
```{r echo=FALSE, fig.height=8, fig.width=10}
# Histogram
p <- ggplot(data, aes(x = TIEMPO.DE.CIRUGIA, fill = factor(GRUPO))) +
  geom_histogram(colour = "black",
                 lwd = 0.75,
                 linetype = 1,
                 position = "identity",
                 binwidth = 60,
                 alpha = 0.5) +
  labs(fill = "Grupo",
       x="Tiempo de Cirugía (min)",
       y="Frequencia",
       title="Histograma de Tiempo de Cirugía (min) por Grupo") +
  theme(plot.title = element_text(size=12))
p
#ggplotly(p)
```

### 2.12) Tiempo de Anestesia (min)

Plot de Violín por Grupo
```{r echo=FALSE, fig.height=8, fig.width=10}
p <- ggplot(data, aes(x=GRUPO, y=TIEMPO.DE.ANESTESIA, color=GRUPO)) + 
    geom_violin(trim=FALSE, alpha=0.5) +
    geom_jitter(shape=16, position=position_jitter(0.1)) +
    geom_boxplot(width=0.1) +
    labs(fill = "Grupo",
       x="Grupo",
       y="Tiempo de Cirugía (min)",
       title="Violin Plots de Tiempo de Anestesia (min) por Grupo") +
    theme(plot.title = element_text(size=12))
p
#ggplotly(p)
```

Histograma por Grupos
```{r echo=FALSE, fig.height=8, fig.width=10}
# Histogram
p <- ggplot(data, aes(x = TIEMPO.DE.ANESTESIA, fill = factor(GRUPO))) +
  geom_histogram(colour = "black",
                 lwd = 0.75,
                 linetype = 1,
                 position = "identity",
                 binwidth = 60,
                 alpha = 0.5) +
  labs(fill = "Grupo",
       x="Tiempo de Cirugía (min)",
       y="Frequencia",
       title="Histograma de Tiempo de Anestesia (min) por Grupo") +
  theme(plot.title = element_text(size=12))
p
#ggplotly(p)
```

### 2.13) Reacciones Adversas

Gráficas de Barras Agrupadas por Grupo.
```{r echo=FALSE, fig.height=8, fig.width=10}
# Group
data_summary <- data %>%
  group_by(GRUPO, REACCIONES.ADVERSAS) %>%
  summarise(n = n(), .groups = 'drop')

# Plot
p <- ggplot(data_summary, aes(x = GRUPO, y = n, fill = REACCIONES.ADVERSAS)) +
  geom_bar(stat = "identity", position = position_dodge(), colour = "black", lwd = 0.5) +
  geom_text(aes(x = GRUPO, y = n + 0.25, label = n),
            position = position_dodge(width = 0.9),
            vjust = -0.25) +
  labs(title = "Proporciones de Reacciones Adversas por Grupo",
       fill = "Reacciones Adversas",
       x = NULL,
       y = "Frequencia") +
  theme_minimal()
p
#ggplotly(p)
```

Gráficas de Pie con Pruebas de X2
```{r echo=FALSE, fig.height=6, fig.width=10}
# Categorical Test
p <- ggstatsplot::ggpiestats(
    data = data,
    x = REACCIONES.ADVERSAS,
    y = GRUPO,
    type = "nonparametric",
    title = "Proporciones de Reacciones Adversas por Grupo",
    pairwise.display = "significant",
    p.adjust.method = "holm"
)
p
```

## 3) Estadística Inferencial: Prubas de Hipótesis

### 3.1) Tests pareados de U-Mann-Whitney (t-test de dos lados no paramétrico).

#### 3.1.1) Tiempo de Cirugía (min)

```{r echo=FALSE, fig.height=6, fig.width=10}

p <- ggstatsplot::ggbetweenstats(
    data = data,
    x = GRUPO,
    y = TIEMPO.DE.CIRUGIA,
    type = "nonparametric",
    pairwise.display = "significant",
    p.adjust.method = "BH",
    digits = "signif",
    xlab = "Grupos",
    ylab = "Tiempo de Cirugía (min)",
    title = "Tiempo de Cirugía (min)"
)
p
```

#### 3.1.2) Tiempo de Anestesia

```{r echo=FALSE, fig.height=6, fig.width=10}

p <- ggstatsplot::ggbetweenstats(
    data = data,
    x = GRUPO,
    y = TIEMPO.DE.ANESTESIA,
    type = "nonparametric",
    pairwise.display = "significant",
    p.adjust.method = "BH",
    digits = "signif",
    xlab = "Grupos",
    ylab = "Tiempo de Anestesia (min)",
    title = "Tiempo de Anestesia (min)"
)
p
```

